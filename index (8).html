<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python ì¸í„°ë™í‹°ë¸Œ í•™ìŠµ ì‹œìŠ¤í…œ ğŸ (ì‹¤í–‰ ê²€ì¦)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ë¡œê·¸ì¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-modal {
            background: white;
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: modalSlideIn 0.4s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-modal h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .login-modal p {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .login-form input {
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* í—¤ë”ì— ì‚¬ìš©ì ì •ë³´ ë° ë²„íŠ¼ ì¶”ê°€ */
        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.6em;
            font-weight: bold;
        }

        .user-details {
            text-align: left;
        }

        .user-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .user-id {
            font-size: 0.95em;
            color: #666;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .dashboard-btn, .logout-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dashboard-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .logout-btn {
            background: #f0f0f0;
            color: #666;
        }

        .dashboard-btn:hover, .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
            text-align: center;
        }

        .python-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3776ab 0%, #ffd43b 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: bold;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 1em;
            margin-top: 5px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-top {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header-buttons {
                width: 100%;
            }
            
            .dashboard-btn, .logout-btn {
                flex: 1;
            }
        }

        .panel {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .topic-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .topic-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .topic-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .topic-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .question-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .question-text {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .code-editor {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 150px;
            margin-bottom: 15px;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.5;
        }

        textarea.code-input {
            width: 100%;
            min-height: 200px;
            background: #282c34;
            color: #abb2bf;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            line-height: 1.5;
        }

        .output-box {
            background: #1e1e1e;
            color: #4ec9b0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 100px;
            margin-top: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .hint-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .hint-box.show {
            display: block;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            display: none;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.show {
            display: block;
        }

        .feedback.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .feedback.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .difficulty-easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-modal">
            <h2>ğŸ Python í•™ìŠµ ì‹œì‘!</h2>
            <p>í•™ìŠµì„ ì‹œì‘í•˜ë ¤ë©´ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            <form id="login-form" class="login-form" onsubmit="handleLogin(event)">
                <input type="text" id="student-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                <input type="text" id="student-id" placeholder="í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" required>
                <button type="submit" class="login-btn">í•™ìŠµ ì‹œì‘í•˜ê¸° ğŸš€</button>
            </form>
        </div>
    </div>

    <!-- Python ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Python ì‹¤í–‰ í™˜ê²½ ë¡œë”© ì¤‘...</h2>
            <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ì•½ 10ì´ˆ)</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="user-info-section">
                    <div class="user-avatar" id="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name" id="user-name">ì‚¬ìš©ì</div>
                        <div class="user-id" id="user-id-display">í•™ë²ˆ: -</div>
                    </div>
                </div>
                <div class="header-buttons">
                    <button class="dashboard-btn" onclick="goToDashboard()">
                        ğŸ† Class Leader Board
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
            <h1>ğŸ Python ì¸í„°ë™í‹°ë¸Œ í•™ìŠµ ì‹œìŠ¤í…œ</h1>
            <p>ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , ì‹¤í–‰í•˜ê³ , ë§ˆìŠ¤í„°í•˜ì„¸ìš”!</p>
            <div style="text-align: center;">
                <span class="python-badge">ğŸš€ ìš°ì†¡ëŒ€, ìš°ë¦¬ëŠ” AIë¡œ íŒŒì´ì¬ì„ ë°°ìš´ë‹¤</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="score">0</span>
                <span class="stat-label">ì ìˆ˜</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="solved">0</span>
                <span class="stat-label">í•´ê²°í•œ ë¬¸ì œ</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="streak">0</span>
                <span class="stat-label">ì—°ì† ì •ë‹µ</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="level">1</span>
                <span class="stat-label">ë ˆë²¨</span>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%">0%</div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“š í•™ìŠµ ì£¼ì œ ì„ íƒ</h2>
                <div class="topic-buttons">
                    <button class="topic-btn active" onclick="loadTopic('datatypes')">ìë£Œí˜•</button>
                    <button class="topic-btn" onclick="loadTopic('numpy')">Numpy</button>
                    <button class="topic-btn" onclick="loadTopic('pandas')">Pandas</button>
                    <button class="topic-btn" onclick="loadTopic('data_loading')">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="topic-btn" onclick="loadTopic('operations')">ì—°ì‚°</button>
                </div>

                <div class="question-card">
                    <div class="question-text" id="question">ë¬¸ì œë¥¼ ë¡œë”© ì¤‘...</div>
                    <div class="code-editor" id="example-code"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-warning" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
                    <button class="btn btn-success" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¡ï¸</button>
                </div>

                <div class="hint-box" id="hint"></div>
            </div>

            <div class="panel">
                <h2>ğŸ’» ì½”ë“œ ì‘ì„± ê³µê°„</h2>
                <textarea class="code-input" id="code-input" placeholder="ì—¬ê¸°ì— Python ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="runCode()" id="run-btn">â–¶ï¸ ì‹¤í–‰ ë° ì •ë‹µ í™•ì¸</button>
                    <button class="btn btn-primary" onclick="clearCode()">ğŸ—‘ï¸ ì½”ë“œ ì§€ìš°ê¸°</button>
                </div>

                <div class="feedback" id="feedback"></div>

                <h3 style="margin-top: 20px; color: #667eea;">ğŸ’¡ ì‹¤í–‰ ê²°ê³¼:</h3>
                <div class="output-box" id="output">ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...</div>

                <h3 style="margin-top: 20px; color: #667eea;">âœ… ì˜ˆìƒ ì¶œë ¥:</h3>
                <div class="output-box" id="expected-output">ì •ë‹µ í™•ì¸ ì‹œ ì˜ˆìƒ ì¶œë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
        </div>
    </div>

    <!-- Pyodide ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ì‚¬ìš©ì ì •ë³´
        let currentUser = null;

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin(event) {
            event.preventDefault();
            
            const name = document.getElementById('student-name').value.trim();
            const studentId = document.getElementById('student-id').value.trim();
            
            if (!name || !studentId) {
                alert('ì´ë¦„ê³¼ í•™ë²ˆì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            currentUser = {
                studentName: name,
                studentId: studentId,
                loginTime: new Date().toISOString()
            };

            // localStorageì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            displayUserInfo(name, studentId);

            // ë¡œê·¸ì¸ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
            document.getElementById('login-overlay').classList.add('hidden');

            // ë¡œë”© í™”ë©´ í‘œì‹œ ë° Python ì´ˆê¸°í™”
            document.getElementById('loading-overlay').classList.remove('hidden');
            initPython();
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(name, studentId) {
            document.getElementById('user-name').textContent = name;
            document.getElementById('user-id-display').textContent = `í•™ë²ˆ: ${studentId}`;
            
            // ì•„ë°”íƒ€ì— ì´ë¦„ ì²« ê¸€ì í‘œì‹œ
            const initial = name.charAt(0).toUpperCase();
            document.getElementById('user-avatar').textContent = initial;
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ë˜ì§€ ì•Šì€ ì§„í–‰ ìƒí™©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
                // ì§„í–‰ ìƒí™© ì €ì¥
                saveProgressToFirebase();
                
                // ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
                localStorage.removeItem('currentUser');
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                location.reload();
            }
        }

        // Dashboardë¡œ ì´ë™
        function goToDashboard() {
            // ì§„í–‰ ìƒí™© ì €ì¥
            saveProgressToFirebase();
            
            // Dashboard í˜ì´ì§€ë¡œ ì´ë™ (ìƒˆ íƒ­)
            window.open('dashboard.html', '_blank');
        }

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBHOBXMqpBDsDIMONQqWZ83qxIxhU0VyG8",
       		authDomain: "python-learning-system.firebaseapp.com",
       		databaseURL: "https://python-learning-system-default-rtdb.asia-southeast1.firebasedatabase.app",
       		projectId: "python-learning-system",
       		storageBucket: "python-learning-system.firebasestorage.app",
      		messagingSenderId: "844754646343",
       		appId: "1:844754646343:web:da76658dae2e91d6468862"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Pyodide ì´ˆê¸°í™”
        let pyodide = null;
        let pythonReady = false;

        async function initPython() {
            try {
                console.log('ğŸ”„ Pyodide ë¡œë”© ì‹œì‘...');
                pyodide = await loadPyodide();
                
                // ê¸°ë³¸ íŒ¨í‚¤ì§€ ë¡œë“œ
                await pyodide.loadPackage(['numpy', 'pandas']);
                
                // âœ… ìƒ˜í”Œ CSV íŒŒì¼ ìƒì„± (íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ë¬¸ì œìš©)
                console.log('ğŸ“ ìƒ˜í”Œ ë°ì´í„° íŒŒì¼ ìƒì„± ì¤‘...');
                
                pyodide.FS.writeFile('/file.csv', `name,age,city,salary
Alice,25,Seoul,3000000
Bob,30,Busan,4000000
Charlie,35,Incheon,5000000
David,28,Daegu,3500000
Eve,32,Gwangju,4500000
Frank,27,Seoul,3200000
Grace,29,Busan,3800000
Henry,31,Incheon,4200000`);
                
                pyodide.FS.writeFile('/sales.csv', `product,quantity,price,date
Laptop,5,1200000,2024-01-01
Mouse,20,25000,2024-01-02
Keyboard,15,80000,2024-01-03
Monitor,8,350000,2024-01-04
Laptop,3,1200000,2024-01-05`);
                
                pyodide.FS.writeFile('/students.csv', `student_id,name,math,english,science
1,ê¹€ì² ìˆ˜,85,90,88
2,ì´ì˜í¬,92,88,95
3,ë°•ë¯¼ìˆ˜,78,85,80
4,ìµœì§€ì€,95,92,97
5,ì •í•˜ëŠ˜,88,86,90`);
                
                // ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ë£¨íŠ¸ë¡œ ë³€ê²½
                pyodide.FS.chdir('/');
                
                console.log('âœ… ìƒ˜í”Œ íŒŒì¼ ìƒì„± ì™„ë£Œ: file.csv, sales.csv, students.csv');
                console.log('ğŸ“‚ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬:', pyodide.FS.cwd());
                
                pythonReady = true;
                console.log('âœ… Python ì‹¤í–‰ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ!');
                
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
                document.getElementById('loading-overlay').classList.add('hidden');
                
                // ì €ì¥ëœ ì§„í–‰ ìƒí™© ë¡œë“œ
                loadProgressFromFirebase();
                
                // ì²« ë¬¸ì œ ë¡œë“œ
                loadQuestionsFromFirebase();
            } catch (error) {
                console.error('âŒ Python ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('Python ì‹¤í–‰ í™˜ê²½ì„ ë¡œë“œí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë¬¸ì œ ë°ì´í„°
        let questions = {
            'datatypes': [],
            'numpy': [],
            'pandas': [],
            'data_loading': [],
            'operations': []
        };

        let questionsLoaded = false;

        // Firebaseì—ì„œ ë¬¸ì œ ë¡œë“œ
        function loadQuestionsFromFirebase() {
            console.log('ğŸ”„ Firebaseì—ì„œ ë¬¸ì œë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...');
            
            database.ref('questions').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    
                    if (!data) {
                        console.error('âŒ Firebaseì— ë¬¸ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                        alert('ë¬¸ì œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    for (let category in data) {
                        if (!questions[category]) {
                            questions[category] = [];
                        }
                        
                        const categoryQuestions = data[category];
                        for (let qId in categoryQuestions) {
                            const q = categoryQuestions[qId];
                            
                            if (q.enabled !== false) {
                                questions[category].push({
                                    id: q.id,
                                    question: q.question,
                                    example: q.example,
                                    hint: q.hint,
                                    expectedOutput: q.expectedOutput,
                                    keywords: Array.isArray(q.keywords) ? q.keywords : q.keywords.split(',').map(k => k.trim()),
                                    difficulty: q.difficulty || 'medium',
                                    points: q.points || 100,
                                    order: q.order || 999
                                });
                            }
                        }
                        
                        questions[category].sort((a, b) => a.order - b.order);
                    }
                    
                    questionsLoaded = true;
                    console.log('âœ… ë¬¸ì œ ë¡œë“œ ì™„ë£Œ!');
                    
                    gameState.totalQuestions = calculateTotalQuestions();
                    loadQuestion();
                    updateStats();
                })
                .catch((error) => {
                    console.error('âŒ Firebase ë¡œë“œ ì˜¤ë¥˜:', error);
                    alert('ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
        }

        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentTopic: 'datatypes',
            currentQuestion: 0,
            score: 0,
            solved: 0,
            streak: 0,
            level: 1,
            totalQuestions: 0
        };

        function calculateTotalQuestions() {
            let total = 0;
            for (let topic in questions) {
                total += questions[topic].length;
            }
            return total;
        }

        // Firebaseì— ì§„í–‰ ìƒí™© ì €ì¥
        function saveProgressToFirebase() {
            if (!currentUser) return;
            
            const progressData = {
                studentName: currentUser.studentName,
                studentId: currentUser.studentId,
                score: gameState.score,
                solved: gameState.solved,
                streak: gameState.streak,
                level: gameState.level,
                lastUpdated: new Date().toISOString()
            };
            
            // Firebaseì— ì €ì¥ (í•™ë²ˆì„ í‚¤ë¡œ ì‚¬ìš©)
            database.ref('students/' + currentUser.studentId).set(progressData)
                .then(() => {
                    console.log('âœ… ì§„í–‰ ìƒí™© ì €ì¥ ì™„ë£Œ!');
                })
                .catch((error) => {
                    console.error('âŒ ì§„í–‰ ìƒí™© ì €ì¥ ì˜¤ë¥˜:', error);
                });
        }

        // Firebaseì—ì„œ ì§„í–‰ ìƒí™© ë¡œë“œ
        function loadProgressFromFirebase() {
            if (!currentUser) return;
            
            database.ref('students/' + currentUser.studentId).once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        gameState.score = data.score || 0;
                        gameState.solved = data.solved || 0;
                        gameState.streak = data.streak || 0;
                        gameState.level = data.level || 1;
                        updateStats();
                        console.log('âœ… ì§„í–‰ ìƒí™© ë¡œë“œ ì™„ë£Œ!');
                    }
                })
                .catch((error) => {
                    console.error('âŒ ì§„í–‰ ìƒí™© ë¡œë“œ ì˜¤ë¥˜:', error);
                });
        }

        // Python ì½”ë“œ ì‹¤í–‰
        async function runCode() {
            if (!pythonReady) {
                alert('Python ì‹¤í–‰ í™˜ê²½ì´ ì•„ì§ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const code = document.getElementById('code-input').value.trim();
            const outputDiv = document.getElementById('output');
            const runBtn = document.getElementById('run-btn');
            
            if (!code) {
                alert('ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                runBtn.disabled = true;
                runBtn.textContent = 'â³ ì‹¤í–‰ ì¤‘...';
                outputDiv.textContent = 'ì‹¤í–‰ ì¤‘...';
                
                // stdout ìº¡ì²˜ë¥¼ ìœ„í•œ ì„¤ì •
                let output = '';
                pyodide.setStdout({
                    batched: (msg) => { output += msg + '\n'; }
                });

                // ì½”ë“œ ì‹¤í–‰
                await pyodide.runPythonAsync(code);
                
                // ì¶œë ¥ ê²°ê³¼ í‘œì‹œ
                outputDiv.textContent = output || '(ì¶œë ¥ ì—†ìŒ)';
                outputDiv.style.color = '#4ec9b0';
                
                // ì •ë‹µ í™•ì¸
                checkAnswer(output.trim());
                
            } catch (error) {
                outputDiv.textContent = `âŒ ì˜¤ë¥˜:\n${error.message}`;
                outputDiv.style.color = '#ff6b6b';
                
                const feedback = document.getElementById('feedback');
                feedback.textContent = 'âŒ ì½”ë“œ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¬¸ë²•ì„ í™•ì¸í•´ì£¼ì„¸ìš”!';
                feedback.className = 'feedback error show';
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'â–¶ï¸ ì‹¤í–‰ ë° ì •ë‹µ í™•ì¸';
            }
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswer(actualOutput) {            
            const topic = gameState.currentTopic;
            const qIndex = gameState.currentQuestion;
            const q = questions[topic][qIndex];
            
            const expectedOutput = q.expectedOutput.trim();
            
            let points = 100;
            if (q.difficulty === 'medium') points = 150;
            if (q.difficulty === 'hard') points = 200;
            
            const feedback = document.getElementById('feedback');
            const expectedOutputDiv = document.getElementById('expected-output');
            
            // ì¶œë ¥ ë¹„êµ (ê³µë°± ì •ê·œí™”)
            const normalizedActual = actualOutput.replace(/\s+/g, ' ').trim();
            const normalizedExpected = expectedOutput.replace(/\s+/g, ' ').trim();
            
            // ì •ë‹µ íŒì •
            const isCorrect = normalizedActual === normalizedExpected || 
                              actualOutput === expectedOutput ||
                              // ë¶€ë¶„ ì¼ì¹˜ë„ í—ˆìš© (ë‚œìˆ˜ ë“±)
                              (q.difficulty === 'medium' && normalizedActual.includes(normalizedExpected.substring(0, 10)));
            
            if (isCorrect) {
                gameState.score += points;
                gameState.solved++;
                gameState.streak++;
                
                if (gameState.score >= gameState.level * 500) {
                    gameState.level++;
                }
                
                feedback.textContent = `âœ… ì •ë‹µì…ë‹ˆë‹¤! +${points}ì  (ì—°ì† ${gameState.streak}ë¬¸ì œ)`;
                feedback.className = 'feedback success show';
                expectedOutputDiv.textContent = `ì˜ˆìƒ ì¶œë ¥:\n${expectedOutput}`;
                expectedOutputDiv.style.color = '#4ec9b0';
                
                updateStats();
                saveProgressToFirebase();

                setTimeout(nextQuestion,3000);
                                
            } else {
                // ì˜¤ë‹µì¸ ê²½ìš° ì¦‰ì‹œ ì¬í™œì„±í™”
                
                gameState.streak = 0;
                
                feedback.textContent = `âŒ ì¶œë ¥ ê²°ê³¼ê°€ ë‹¤ë¦…ë‹ˆë‹¤!\n\nì‹¤ì œ ì¶œë ¥ê³¼ ì˜ˆìƒ ì¶œë ¥ì„ ë¹„êµí•´ë³´ì„¸ìš”.`;
                feedback.className = 'feedback error show';
                expectedOutputDiv.textContent = `ì˜ˆìƒ ì¶œë ¥:\n${expectedOutput}`;
                expectedOutputDiv.style.color = '#ff6b6b';
                
                updateStats();
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('solved').textContent = gameState.solved;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('level').textContent = gameState.level;
            
            const progress = (gameState.solved / gameState.totalQuestions) * 100;
            const progressBar = document.getElementById('progress');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        // ì£¼ì œ ë¡œë“œ
        function loadTopic(topic) {
            gameState.currentTopic = topic;
            gameState.currentQuestion = 0;
            
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            loadQuestion();
        }

        // ë¬¸ì œ ë¡œë“œ
        function loadQuestion() {
            if (!questionsLoaded) {
                document.getElementById('question').innerHTML = 'ë¬¸ì œë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...';
                return;
            }
            
            const topic = gameState.currentTopic;
            const qIndex = gameState.currentQuestion;
            
            if (!questions[topic] || questions[topic].length === 0) {
                document.getElementById('question').innerHTML = `âš ï¸ "${topic}" ì£¼ì œì— ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.`;
                return;
            }
            
            if (qIndex >= questions[topic].length) {
                gameState.currentQuestion = 0;
                loadQuestion();
                return;
            }
            
            const q = questions[topic][qIndex];
            
            const difficultyBadge = `<span class="difficulty-badge difficulty-${q.difficulty}">${q.difficulty === 'easy' ? 'ì‰¬ì›€' : q.difficulty === 'medium' ? 'ë³´í†µ' : 'ì–´ë ¤ì›€'}</span>`;
            
            document.getElementById('question').innerHTML = q.question + difficultyBadge;
            document.getElementById('example-code').textContent = q.example;
            document.getElementById('hint').textContent = q.hint;
            document.getElementById('hint').classList.remove('show');
            document.getElementById('feedback').classList.remove('show');
            document.getElementById('output').textContent = 'ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('output').style.color = '#4ec9b0';
            document.getElementById('expected-output').textContent = 'ì •ë‹µ í™•ì¸ ì‹œ ì˜ˆìƒ ì¶œë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('expected-output').style.color = '#4ec9b0';
        }

        // íŒíŠ¸ í‘œì‹œ
        function showHint() {
            document.getElementById('hint').classList.add('show');
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            gameState.currentQuestion++;
            loadQuestion();
        }

        // ì½”ë“œ ì§€ìš°ê¸°
        function clearCode() {
            if (confirm('ì‘ì„±í•œ ì½”ë“œë¥¼ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('code-input').value = '';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.onload = function() {
            // ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ í™•ì¸
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                displayUserInfo(currentUser.studentName, currentUser.studentId);
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('loading-overlay').classList.remove('hidden');
                initPython();
            }
            // ì €ì¥ëœ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ ëª¨ë‹¬ì´ ìë™ìœ¼ë¡œ í‘œì‹œë¨
        };

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ì§„í–‰ ìƒí™© ì €ì¥
        window.addEventListener('beforeunload', function() {
            saveProgressToFirebase();
        });

        // ì£¼ê¸°ì ìœ¼ë¡œ ì§„í–‰ ìƒí™© ì €ì¥ (1ë¶„ë§ˆë‹¤)
        setInterval(saveProgressToFirebase, 60000);
    </script>
</body>
</html>
